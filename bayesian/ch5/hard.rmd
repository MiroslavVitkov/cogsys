#!/usr/bin/env Rscript


#<!---
library(rmarkdown)
argv <- commandArgs(trailingOnly=FALSE)
fname <- sub("--file=", "", argv[grep("--file=", argv)])
render(fname, output_format="pdf_document")
quit(status=0)
#-->


---
title: "Multivariate Linear Models"
author: Miroslav Vitkov
date: "compiled on: `r Sys.time()`"
---


5H1.  
Fit two bivariate Gaussian regressions, using map : (1) body weight as a linear function of territory size ( area ), and (2) body weight as a linear function of groupsize.
Plot the results of these regressions, displaying the MAP regression line and the 95% interval of the mean.
Is either variable important for predicting fox body weight?
```{r, results='hide', message=FALSE}
library( rethinking )
```
```{r}
data( foxes )

weight.vs.area <- rethinking::map( alist( weight ~ dnorm( mu , sigma )
                                        , mu <- a + b*area
                                        , a ~ dnorm( 4.5, 1 )
                                        , b ~ dnorm( 0, 10 )
                                        , sigma ~ dunif( 0, 50 ) )
                                 , data=foxes )
weight.vs.area

weight.vs.groupsize <- rethinking::map( alist( weight ~ dnorm( mu , sigma )
                                             , mu <- a + b*groupsize
                                             , a ~ dnorm( 4.5, 1 )
                                             , b ~ dnorm( 0, 10 )
                                             , sigma ~ dunif( 0, 50 ) )
                                      , data=foxes )
weight.vs.groupsize

# Read individual parameters off the trained models.
get.param <- function( model, param.name )
{
    c <- model@coef[ param.name ]
    as.numeric( c )
}


draw <- function( model )
{
    a <- get.param( model, "a" )
    b <- get.param( model, "b" )
    ggplot() +
        geom_point( data=foxes, mapping=aes(x=1:nrow(foxes), y=weight) ) +
        geom_abline( intercept=a, slope=b )
}

draw( weight.vs.area )
draw( weight.vs.groupsize )
```

The `area` feature seems to predict fox weight somewhat well.


5H2. Now fit a multiple linear regression with weight as the outcome and both area and groupsize as predictor variables.
Plot the predictions of the model for each predictor, holding the other predictor constant at its mean.
What does this model say about the importance of each variable?
Why do you get different results than you got in the exercise just above?
A:  

```{r}
multivar <- rethinking::map( alist( weight ~ dnorm( mu , sigma )
                                             , mu <- a + b*area + c*groupsize
                                             , a ~ dnorm( 4.5, 1 )
                                             , b ~ dnorm( 0, 10 )
                                             , c ~ dnorm( 0, 10 )
                                             , sigma ~ dunif( 0, 50 ) )
                                      , data=foxes )

#draw2 <- function( model )
#{
    model <- multivar

    a <- get.param( model, "a" )
    b <- get.param( model, "b" )
    c <- get.param( model, "c" )

    # Why is no plot generated if this is executed within `local({})`?
    ggplot() +
        geom_point( data=foxes, mapping=aes(x=1:nrow(foxes), y=weight) ) +
        geom_abline( intercept=a+c*mean(foxes$groupsize), slope=b, colour="blue" )
        geom_abline( intercept=a+b*mean(foxes$area), slope=c, colour="green" )

a+c*mean(foxes$groupsize)
a+b*mean(foxes$area)
#}

#draw2( multivar )
```
